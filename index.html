<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>The Manhattan Penthouse | Professional VR Tour</title>
    <meta name="description" content="Immersive 360¬∞ virtual tour with interactive hotspots, minimap navigation, measurement tools, and professional features">
    
    <!-- Pannellum 360¬∞ Viewer -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    
    <!-- Advanced Features Module -->
    <script src="advanced-features.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold: #C9A961;
            --gold-light: #F4E4C1;
            --dark: #0f0c29;
            --glass: rgba(0,0,0,0.85);
            --glass-light: rgba(0,0,0,0.6);
            --border: rgba(201, 169, 97, 0.3);
            --shadow: 0 20px 60px rgba(0,0,0,0.9);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
            -webkit-font-smoothing: antialiased;
        }

        #panorama {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* ==================== LOADING SCREEN ==================== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 900;
            color: #000;
            font-family: 'Playfair Display', serif;
            margin-bottom: 40px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }

        .loading-title {
            font-family: 'Playfair Display', serif;
            font-size: 52px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            letter-spacing: 4px;
            text-align: center;
        }

        .loading-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 50px;
            font-weight: 300;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .loading-bar {
            width: 400px;
            height: 3px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
            margin-bottom: 30px;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 20px rgba(201, 169, 97, 0.6);
        }

        .loading-status {
            margin-bottom: 40px;
            font-size: 13px;
            color: rgba(255,255,255,0.5);
            font-weight: 300;
        }

        .enter-btn {
            padding: 18px 50px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: #000;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 10px 40px rgba(201, 169, 97, 0.4);
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeInButton 0.5s ease 1.5s forwards;
        }

        @keyframes fadeInButton {
            to { opacity: 1; }
        }

        .enter-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(201, 169, 97, 0.6);
        }

        /* ==================== HEADER ==================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            background: linear-gradient(180deg, var(--glass) 0%, rgba(0,0,0,0) 100%);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            animation: slideDown 1s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            color: #000;
            font-family: 'Playfair Display', serif;
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--gold);
        }

        .brand-tagline {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .property-header {
            text-align: center;
        }

        .property-name {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .property-location {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: #000;
            box-shadow: 0 4px 15px rgba(201, 169, 97, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 169, 97, 0.5);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        /* ==================== MINIMAP ==================== */
        .minimap-container {
            position: fixed;
            bottom: 30px;
            left: 140px;
            width: 280px;
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow), 0 0 0 1px var(--border);
            z-index: 1000;
            animation: slideInLeft 1s ease 0.5s both;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .minimap-title {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .minimap-canvas {
            width: 100%;
            height: 200px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .minimap-canvas img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            opacity: 0.7;
        }

        .minimap-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--gold);
            border: 3px solid #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(201, 169, 97, 0.8);
            animation: markerPulse 2s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes markerPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        .minimap-direction {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 12px solid var(--gold);
            transform-origin: center;
            filter: drop-shadow(0 0 5px rgba(201, 169, 97, 0.8));
        }

        /* ==================== COMPASS ==================== */
        .compass {
            position: fixed;
            top: 120px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 50%;
            box-shadow: var(--shadow), 0 0 0 1px var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 1s ease 0.7s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .compass-needle {
            width: 60px;
            height: 60px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .compass-needle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 25px solid #ff4444;
            transform: translate(-50%, -100%);
        }

        .compass-needle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 25px solid #fff;
            transform: translate(-50%, 0%);
        }

        .compass-label {
            position: absolute;
            font-size: 10px;
            font-weight: 700;
            color: var(--gold);
        }

        .compass-label.n { top: 5px; left: 50%; transform: translateX(-50%); }
        .compass-label.e { right: 8px; top: 50%; transform: translateY(-50%); }
        .compass-label.s { bottom: 5px; left: 50%; transform: translateX(-50%); }
        .compass-label.w { left: 8px; top: 50%; transform: translateY(-50%); }

        /* ==================== ROOM GALLERY ==================== */
        .room-gallery {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass);
            backdrop-filter: blur(30px);
            padding: 15px 20px;
            border-radius: 100px;
            display: flex;
            gap: 12px;
            box-shadow: var(--shadow), 0 0 0 1px var(--border);
            z-index: 1000;
            animation: slideUp 1s ease 0.3s both;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 150px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        .room-thumb {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            border: 3px solid transparent;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(255,255,255,0.05);
        }

        .room-thumb:hover {
            transform: translateY(-8px) scale(1.1);
            border-color: rgba(201, 169, 97, 0.5);
        }

        .room-thumb.active {
            border-color: var(--gold);
            box-shadow: 0 8px 25px rgba(201, 169, 97, 0.5);
            transform: translateY(-8px) scale(1.1);
        }

        .room-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .room-thumb-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            padding: 8px 6px 6px;
            font-size: 9px;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .room-thumb-icon {
            position: absolute;
            top: 6px;
            right: 6px;
            font-size: 18px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* ==================== HOTSPOTS ==================== */
        .pnlm-hotspot {
            width: 60px !important;
            height: 60px !important;
            background: radial-gradient(circle, rgba(201, 169, 97, 0.9) 0%, rgba(201, 169, 97, 0.3) 70%, transparent 100%) !important;
            border: 3px solid var(--gold) !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 28px !important;
            animation: hotspotPulse 2s ease-in-out infinite !important;
            box-shadow: 0 0 30px rgba(201, 169, 97, 0.6) !important;
        }

        @keyframes hotspotPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(201, 169, 97, 0.6); }
            50% { transform: scale(1.15); box-shadow: 0 0 50px rgba(201, 169, 97, 0.9); }
        }

        .pnlm-hotspot:hover {
            transform: scale(1.3) !important;
            background: radial-gradient(circle, rgba(201, 169, 97, 1) 0%, rgba(201, 169, 97, 0.5) 70%, transparent 100%) !important;
            box-shadow: 0 0 60px rgba(201, 169, 97, 1) !important;
        }

        .hotspot-nav {
            color: #fff !important;
            text-shadow: 0 2px 8px rgba(0,0,0,0.8);
        }

        .hotspot-info {
            background: var(--glass) !important;
            backdrop-filter: blur(20px) !important;
            border: 2px solid var(--gold) !important;
            color: #fff !important;
        }

        /* ==================== INFO PANEL ==================== */
        .info-panel {
            position: fixed;
            top: 120px;
            right: 30px;
            width: 350px;
            max-height: calc(100vh - 170px);
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 30px;
            overflow-y: auto;
            box-shadow: var(--shadow), 0 0 0 1px var(--border);
            z-index: 1000;
            animation: slideInRight 1s ease 0.5s both;
            transform: translateX(0);
            transition: transform 0.3s ease;
        }

        .info-panel.collapsed {
            transform: translateX(calc(100% + 30px));
        }

        @keyframes slideInRight {
            from { transform: translateX(500px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .info-toggle {
            position: fixed;
            top: 120px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow), 0 0 0 1px var(--border);
            z-index: 1001;
            transition: all 0.3s ease;
            animation: fadeIn 1s ease 0.5s both;
        }

        .info-toggle:hover {
            background: rgba(201, 169, 97, 0.2);
            transform: scale(1.1);
        }

        .info-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .info-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--gold);
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        .info-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .info-stat {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.1) 0%, rgba(244, 228, 193, 0.05) 100%);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .info-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--gold);
            font-family: 'Playfair Display', serif;
        }

        .info-stat-label {
            font-size: 10px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .info-features {
            list-style: none;
        }

        .info-features li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .info-features li::before {
            content: "‚úì";
            color: var(--gold);
            font-weight: bold;
            flex-shrink: 0;
        }

        /* ==================== SCENE TRANSITION ==================== */
        .scene-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .scene-transition.active {
            opacity: 1;
            pointer-events: all;
        }

        .transition-content {
            text-align: center;
        }

        .transition-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(201, 169, 97, 0.2);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .transition-text {
            font-size: 16px;
            color: var(--gold);
            font-weight: 600;
        }

        /* Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            border-radius: 3px;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .info-panel {
                width: 300px;
            }
            
            .minimap-container {
                width: 240px;
                left: 120px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .brand-text,
            .property-header {
                display: none;
            }

            .minimap-container {
                bottom: 140px;
                left: 20px;
                width: 200px;
            }

            .compass {
                top: 90px;
                right: 20px;
                width: 60px;
                height: 60px;
            }

            .compass-needle {
                width: 45px;
                height: 45px;
            }

            .room-gallery {
                bottom: 20px;
                padding: 12px 15px;
                gap: 8px;
                max-width: calc(100% - 40px);
                overflow-x: auto;
            }

            .room-thumb {
                width: 60px;
                height: 60px;
                flex-shrink: 0;
            }

            .info-panel {
                width: calc(100% - 40px);
                max-width: 350px;
                right: 20px;
                top: 90px;
            }

            .info-toggle {
                top: 90px;
                right: 20px;
            }

            .loading-title {
                font-size: 36px;
            }

            .loading-bar {
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading">
        <div class="loading-logo">PE</div>
        <div class="loading-title">THE MANHATTAN</div>
        <div class="loading-subtitle">Professional VR Experience</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-status" id="loadingStatus">Initializing virtual tour...</div>
        <button class="enter-btn" id="enterBtn" onclick="enterTour()">
            Enter Virtual Tour ‚Üí
        </button>
    </div>

    <!-- Scene Transition -->
    <div class="scene-transition" id="sceneTransition">
        <div class="transition-content">
            <div class="transition-spinner"></div>
            <div class="transition-text" id="transitionText">Loading room...</div>
        </div>
    </div>

    <!-- 360¬∞ Panorama Viewer -->
    <div id="panorama"></div>

    <!-- Header -->
    <div class="header">
        <div class="brand">
            <div class="brand-logo">PE</div>
            <div class="brand-text">
                <div class="brand-name">PRESTIGE ESTATES</div>
                <div class="brand-tagline">Luxury Properties</div>
            </div>
        </div>
        <div class="property-header">
            <div class="property-name">The Manhattan Penthouse</div>
            <div class="property-location">432 Park Avenue, 85th Floor</div>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="toggleFullscreen()">
                <span>‚õ∂</span> <span class="btn-text">Fullscreen</span>
            </button>
            <button class="btn btn-primary" onclick="shareProperty()">
                <span>üì§</span> <span class="btn-text">Share</span>
            </button>
        </div>
    </div>

    <!-- Compass -->
    <div class="compass">
        <div class="compass-needle" id="compassNeedle">
            <div class="compass-label n">N</div>
            <div class="compass-label e">E</div>
            <div class="compass-label s">S</div>
            <div class="compass-label w">W</div>
        </div>
    </div>

    <!-- Minimap -->
    <div class="minimap-container">
        <div class="minimap-title">
            <span>üó∫Ô∏è</span> Floor Plan
        </div>
        <div class="minimap-canvas" id="minimapCanvas">
            <img src="https://nyc3.digitaloceanspaces.com/bhindi-drive/files/8861229d-bcce-4983-baed-30a95854423d/2026-02-26T06-24-00-519Z-66c3a7f2-nano-banana-pro_1772087040241.jpg" alt="Floor Plan">
            <div class="minimap-marker" id="minimapMarker">
                <div class="minimap-direction" id="minimapDirection"></div>
            </div>
        </div>
    </div>

    <!-- Room Gallery -->
    <div class="room-gallery" id="roomGallery">
        <!-- Populated by JavaScript -->
    </div>

    <!-- Info Panel Toggle -->
    <div class="info-toggle" id="infoToggle" onclick="toggleInfoPanel()">
        <span style="font-size: 24px;">‚ÑπÔ∏è</span>
    </div>

    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-title" id="roomTitle">Living Room</div>
            <div class="info-subtitle" id="roomSubtitle">Main entertaining space</div>
        </div>

        <div class="info-stats" id="roomStats">
            <!-- Populated by JavaScript -->
        </div>

        <div class="info-section">
            <h3 style="font-size: 14px; color: var(--gold); margin-bottom: 15px; font-weight: 700;">Features</h3>
            <ul class="info-features" id="roomFeatures">
                <!-- Populated by JavaScript -->
            </ul>
        </div>
    </div>

    <!-- Load Toolbar -->
    <script>
        fetch('toolbar.html')
            .then(response => response.text())
            .then(html => {
                const div = document.createElement('div');
                div.innerHTML = html;
                document.body.appendChild(div);
            });
    </script>

    <script>
        // ==================== CONFIGURATION ====================
        const SCENES = {
            living: {
                name: 'Living Room',
                subtitle: 'Main entertaining space',
                panorama: 'https://pannellum.org/images/alma.jpg',
                thumbnail: 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?w=200&h=200&fit=crop',
                icon: 'üõãÔ∏è',
                minimapPosition: { x: 50, y: 50 },
                stats: [
                    { label: 'Size', value: '850 sq ft' },
                    { label: 'Ceiling', value: '12 ft' },
                    { label: 'Windows', value: '6' },
                    { label: 'View', value: '360¬∞' }
                ],
                features: [
                    'Floor-to-ceiling windows with Central Park views',
                    'Italian Carrara marble flooring',
                    'Integrated smart lighting system',
                    'Custom built-in entertainment center',
                    'Gas fireplace with marble surround',
                    'Motorized window treatments'
                ],
                hotspots: [
                    { pitch: -5, yaw: 90, type: 'scene', target: 'kitchen', icon: '‚Üí', tooltip: 'Kitchen' },
                    { pitch: -5, yaw: -90, type: 'scene', target: 'bedroom', icon: '‚Üí', tooltip: 'Master Suite' },
                    { pitch: -10, yaw: 180, type: 'info', text: 'Central Park View', icon: '‚ÑπÔ∏è' }
                ]
            },
            kitchen: {
                name: 'Gourmet Kitchen',
                subtitle: 'Chef-inspired culinary space',
                panorama: 'https://pannellum.org/images/cerro-toco-0.jpg',
                thumbnail: 'https://images.unsplash.com/photo-1556912172-45b7abe8b7e1?w=200&h=200&fit=crop',
                icon: 'üë®‚Äçüç≥',
                minimapPosition: { x: 75, y: 50 },
                stats: [
                    { label: 'Size', value: '450 sq ft' },
                    { label: 'Island', value: '10 ft' },
                    { label: 'Appliances', value: 'Pro' },
                    { label: 'Storage', value: 'Custom' }
                ],
                features: [
                    'Sub-Zero refrigeration and wine storage',
                    'Miele professional-grade appliances',
                    'Calacatta marble countertops and backsplash',
                    'Custom Italian cabinetry with soft-close',
                    'Large center island with seating for 6',
                    'Pot filler and filtered water system'
                ],
                hotspots: [
                    { pitch: -5, yaw: -90, type: 'scene', target: 'living', icon: '‚Üí', tooltip: 'Living Room' },
                    { pitch: -5, yaw: 90, type: 'scene', target: 'terrace', icon: '‚Üí', tooltip: 'Terrace' },
                    { pitch: 0, yaw: 0, type: 'info', text: 'Professional Appliances', icon: '‚ÑπÔ∏è' }
                ]
            },
            bedroom: {
                name: 'Master Suite',
                subtitle: 'Private sanctuary',
                panorama: 'https://pannellum.org/images/jfk.jpg',
                thumbnail: 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=200&h=200&fit=crop',
                icon: 'üõèÔ∏è',
                minimapPosition: { x: 25, y: 50 },
                stats: [
                    { label: 'Size', value: '650 sq ft' },
                    { label: 'Closets', value: '2' },
                    { label: 'Bath', value: 'En-suite' },
                    { label: 'Terrace', value: 'Private' }
                ],
                features: [
                    'King-sized bedroom with sitting area',
                    'Two walk-in closets with custom organization',
                    'En-suite spa bathroom with dual vanities',
                    'Private terrace access',
                    'Automated blackout shades',
                    'Integrated sound system'
                ],
                hotspots: [
                    { pitch: -5, yaw: 90, type: 'scene', target: 'living', icon: '‚Üí', tooltip: 'Living Room' },
                    { pitch: -5, yaw: -90, type: 'scene', target: 'bathroom', icon: '‚Üí', tooltip: 'Spa Bath' },
                    { pitch: -8, yaw: 0, type: 'info', text: 'Custom Walk-in Closets', icon: '‚ÑπÔ∏è' }
                ]
            },
            bathroom: {
                name: 'Spa Bathroom',
                subtitle: 'Luxury wellness retreat',
                panorama: 'https://pannellum.org/images/bma-0.jpg',
                thumbnail: 'https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?w=200&h=200&fit=crop',
                icon: 'üõÅ',
                minimapPosition: { x: 25, y: 75 },
                stats: [
                    { label: 'Size', value: '280 sq ft' },
                    { label: 'Tub', value: 'Soaking' },
                    { label: 'Shower', value: 'Rain' },
                    { label: 'Heated', value: 'Floors' }
                ],
                features: [
                    'Freestanding soaking tub with city views',
                    'Oversized rain shower with body jets',
                    'Dual vanities with marble countertops',
                    'Radiant heated marble floors',
                    'Towel warmers and steam shower',
                    'Smart mirror with integrated lighting'
                ],
                hotspots: [
                    { pitch: -5, yaw: 180, type: 'scene', target: 'bedroom', icon: '‚Üí', tooltip: 'Master Suite' },
                    { pitch: 0, yaw: 90, type: 'info', text: 'Soaking Tub', icon: '‚ÑπÔ∏è' }
                ]
            },
            terrace: {
                name: 'Private Terrace',
                subtitle: 'Outdoor entertaining paradise',
                panorama: 'https://pannellum.org/images/bma-1.jpg',
                thumbnail: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=200&h=200&fit=crop',
                icon: 'üåÜ',
                minimapPosition: { x: 75, y: 25 },
                stats: [
                    { label: 'Size', value: '2,000 sq ft' },
                    { label: 'Kitchen', value: 'Outdoor' },
                    { label: 'Seating', value: '20+' },
                    { label: 'Views', value: '360¬∞' }
                ],
                features: [
                    'Wraparound terrace with panoramic views',
                    'Outdoor kitchen with grill and refrigeration',
                    'Multiple seating and dining areas',
                    'Integrated irrigation system',
                    'Weather-resistant power outlets',
                    'Ambient lighting and heating'
                ],
                hotspots: [
                    { pitch: -5, yaw: -90, type: 'scene', target: 'kitchen', icon: '‚Üí', tooltip: 'Kitchen' },
                    { pitch: -5, yaw: 90, type: 'scene', target: 'living', icon: '‚Üí', tooltip: 'Living Room' },
                    { pitch: -15, yaw: 0, type: 'info', text: 'Skyline Views', icon: '‚ÑπÔ∏è' }
                ]
            }
        };

        // ==================== STATE ====================
        let viewer = null;
        let currentScene = 'living';
        let tourStarted = false;
        let infoPanelCollapsed = false;
        let advancedFeatures = null;

        // ==================== INITIALIZATION ====================
        
        // Loading progress simulation
        let progress = 0;
        const loadingInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress >= 100) {
                progress = 100;
                clearInterval(loadingInterval);
                document.getElementById('loadingStatus').textContent = 'Ready to explore...';
            }
            document.getElementById('loadingProgress').style.width = progress + '%';
        }, 120);

        // Enter tour
        window.enterTour = function() {
            if (!tourStarted) {
                tourStarted = true;
                document.getElementById('loading').classList.add('hidden');
                initViewer();
                initRoomGallery();
                initAdvancedFeatures();
            }
        };

        // Initialize advanced features
        function initAdvancedFeatures() {
            if (window.VRTourAdvanced) {
                advancedFeatures = new VRTourAdvanced(viewer);
                advancedFeatures.trackRoomVisit(currentScene);
                window.advancedFeatures = advancedFeatures;
            }
        }

        // Initialize panorama viewer
        function initViewer() {
            const scene = SCENES[currentScene];
            
            viewer = pannellum.viewer('panorama', {
                type: 'equirectangular',
                panorama: scene.panorama,
                autoLoad: true,
                showControls: false,
                mouseZoom: true,
                autoRotate: -2,
                autoRotateInactivityDelay: 3000,
                hfov: 100,
                pitch: 0,
                yaw: 0,
                minHfov: 50,
                maxHfov: 120,
                friction: 0.15,
                hotSpots: createHotspots(scene.hotspots)
            });

            // Update compass on view change
            viewer.on('mouseup', updateCompass);
            viewer.on('touchend', updateCompass);
            
            updateRoomInfo(currentScene);
            updateMinimap(currentScene);
        }

        // Create hotspots
        function createHotspots(hotspots) {
            return hotspots.map(spot => {
                const config = {
                    pitch: spot.pitch,
                    yaw: spot.yaw,
                    cssClass: spot.type === 'scene' ? 'hotspot-nav' : 'hotspot-info',
                    createTooltipFunc: (hotSpotDiv) => {
                        hotSpotDiv.innerHTML = `<span class="hotspot-${spot.type}">${spot.icon}</span>`;
                        if (spot.tooltip) {
                            hotSpotDiv.title = spot.tooltip;
                        }
                    }
                };

                if (spot.type === 'scene') {
                    config.clickHandlerFunc = () => {
                        loadScene(spot.target);
                        if (advancedFeatures) {
                            advancedFeatures.trackHotspotClick('navigation', spot.target);
                        }
                    };
                } else if (spot.type === 'info') {
                    config.clickHandlerFunc = () => {
                        showInfo(spot.text);
                        if (advancedFeatures) {
                            advancedFeatures.trackHotspotClick('info', spot.text);
                        }
                    };
                }

                return config;
            });
        }

        // Load scene with transition
        window.loadScene = function(sceneName) {
            if (!viewer || sceneName === currentScene) return;

            const scene = SCENES[sceneName];
            const transition = document.getElementById('sceneTransition');
            const transitionText = document.getElementById('transitionText');

            // Show transition
            transitionText.textContent = `Loading ${scene.name}...`;
            transition.classList.add('active');

            // Track analytics
            if (advancedFeatures) {
                advancedFeatures.trackRoomVisit(sceneName);
            }

            // Update scene after delay
            setTimeout(() => {
                currentScene = sceneName;
                
                // Update panorama
                viewer.loadScene(scene.panorama, scene.pitch || 0, scene.yaw || 0, scene.hfov || 100);
                
                // Update hotspots
                viewer.removeAllHotSpots();
                scene.hotspots.forEach(spot => {
                    const config = {
                        pitch: spot.pitch,
                        yaw: spot.yaw,
                        cssClass: spot.type === 'scene' ? 'hotspot-nav' : 'hotspot-info',
                        createTooltipFunc: (hotSpotDiv) => {
                            hotSpotDiv.innerHTML = `<span class="hotspot-${spot.type}">${spot.icon}</span>`;
                            if (spot.tooltip) {
                                hotSpotDiv.title = spot.tooltip;
                            }
                        }
                    };

                    if (spot.type === 'scene') {
                        config.clickHandlerFunc = () => {
                            loadScene(spot.target);
                            if (advancedFeatures) {
                                advancedFeatures.trackHotspotClick('navigation', spot.target);
                            }
                        };
                    } else if (spot.type === 'info') {
                        config.clickHandlerFunc = () => {
                            showInfo(spot.text);
                            if (advancedFeatures) {
                                advancedFeatures.trackHotspotClick('info', spot.text);
                            }
                        };
                    }

                    viewer.addHotSpot(config);
                });

                // Update UI
                updateRoomInfo(sceneName);
                updateMinimap(sceneName);
                updateRoomGallery(sceneName);

                // Hide transition
                setTimeout(() => {
                    transition.classList.remove('active');
                }, 300);
            }, 400);
        };

        // Initialize room gallery
        function initRoomGallery() {
            const gallery = document.getElementById('roomGallery');
            gallery.innerHTML = '';

            Object.keys(SCENES).forEach(sceneKey => {
                const scene = SCENES[sceneKey];
                const thumb = document.createElement('div');
                thumb.className = `room-thumb ${sceneKey === currentScene ? 'active' : ''}`;
                thumb.onclick = () => loadScene(sceneKey);
                thumb.innerHTML = `
                    <img src="${scene.thumbnail}" alt="${scene.name}">
                    <div class="room-thumb-icon">${scene.icon}</div>
                    <div class="room-thumb-label">${scene.name.split(' ')[0]}</div>
                `;
                gallery.appendChild(thumb);
            });
        }

        // Update room gallery active state
        function updateRoomGallery(sceneName) {
            document.querySelectorAll('.room-thumb').forEach((thumb, index) => {
                const sceneKey = Object.keys(SCENES)[index];
                thumb.classList.toggle('active', sceneKey === sceneName);
            });
        }

        // Update room info panel
        function updateRoomInfo(sceneName) {
            const scene = SCENES[sceneName];
            
            document.getElementById('roomTitle').textContent = scene.name;
            document.getElementById('roomSubtitle').textContent = scene.subtitle;

            // Update stats
            const statsContainer = document.getElementById('roomStats');
            statsContainer.innerHTML = scene.stats.map(stat => `
                <div class="info-stat">
                    <div class="info-stat-value">${stat.value}</div>
                    <div class="info-stat-label">${stat.label}</div>
                </div>
            `).join('');

            // Update features
            const featuresContainer = document.getElementById('roomFeatures');
            featuresContainer.innerHTML = scene.features.map(feature => `
                <li>${feature}</li>
            `).join('');
        }

        // Update minimap
        function updateMinimap(sceneName) {
            const scene = SCENES[sceneName];
            const marker = document.getElementById('minimapMarker');
            
            marker.style.left = scene.minimapPosition.x + '%';
            marker.style.top = scene.minimapPosition.y + '%';
        }

        // Update compass
        function updateCompass() {
            if (!viewer) return;
            const yaw = viewer.getYaw();
            const needle = document.getElementById('compassNeedle');
            needle.style.transform = `rotate(${yaw}deg)`;
            
            // Update minimap direction
            const direction = document.getElementById('minimapDirection');
            direction.style.transform = `translate(-50%, -50%) rotate(${yaw}deg)`;
        }

        // Show info
        function showInfo(text) {
            alert(`‚ÑπÔ∏è ${text}\n\nThis is an interactive information hotspot. In a production version, this would show a beautiful modal with detailed information, images, and specifications.`);
        }

        // Toggle info panel
        window.toggleInfoPanel = function() {
            infoPanelCollapsed = !infoPanelCollapsed;
            document.getElementById('infoPanel').classList.toggle('collapsed', infoPanelCollapsed);
            document.getElementById('infoToggle').innerHTML = infoPanelCollapsed 
                ? '<span style="font-size: 24px;">‚ÑπÔ∏è</span>' 
                : '<span style="font-size: 24px;">‚úï</span>';
        };

        // Fullscreen
        window.toggleFullscreen = function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        };

        // Share
        window.shareProperty = function() {
            const url = `${window.location.href}?room=${currentScene}`;
            if (navigator.share) {
                navigator.share({
                    title: `${SCENES[currentScene].name} - The Manhattan Penthouse`,
                    text: 'Explore this stunning luxury penthouse with 360¬∞ virtual tour!',
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url);
                alert(`üîó Link Copied!\n\nDirect link to ${SCENES[currentScene].name}:\n${url}`);
            }
        };

        // Check for room parameter in URL
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const room = params.get('room');
            if (room && SCENES[room]) {
                currentScene = room;
            }
        });

        // Track page unload
        window.addEventListener('beforeunload', () => {
            if (advancedFeatures) {
                const summary = advancedFeatures.getAnalyticsSummary();
                console.log('üìä Final Tour Analytics:', summary);
            }
        });
    </script>
</body>
</html>